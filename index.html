<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Taşkınlar Gurme — Su Sipariş</title>
  <meta name="description" content="Taşkınlar Gurme — Siteye özel hızlı su siparişi. Uygulama yok, üyelik yok." />
  <style>
    :root{
      /* Kırmızı-Yeşil / daha “market & kurumsal” */
      --bg:#f6f7f6;
      --card:#ffffff;
      --card2:#f3f5f4;
      --text:#141615;
      --muted:#5f6b66;
      --line:rgba(20,22,21,.10);

      --accent:#c62828;   /* kırmızı (aksiyon) */
      --accent2:#2e7d32;  /* yeşil (güven/ekleme) */

      --shadow: 0 10px 28px rgba(0,0,0,.08);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background: var(--bg);
      color:var(--text);
      line-height:1.35;
    }
    a{color:inherit}
    .wrap{max-width:1100px;margin:0 auto;padding:20px 14px 70px}
    header{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 14px;
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: var(--card);
      box-shadow: var(--shadow);
      position: sticky; top: 10px; z-index: 10;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
    }
    .brand h1{font-size:16px;margin:0;letter-spacing:.2px}
    .brand p{margin:2px 0 0;font-size:12px;color:var(--muted)}

    .pill{display:flex;gap:8px;align-items:center;flex-wrap:wrap;justify-content:flex-end}
    .tag{
      font-size:12px;padding:8px 10px;border-radius:999px;
      border:1px solid var(--line);
      background: var(--card2);
      color:var(--muted);
      white-space:nowrap;
    }
    .tag strong{color:var(--text); font-weight:700}

    .cta{display:flex;gap:10px;align-items:center}
    .btn{
      border:1px solid var(--line);
      background: var(--card2);
      color:var(--text);
      padding:10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight:700;
      letter-spacing:.2px;
      transition: transform .08s ease, border-color .15s ease, background .15s ease;
    }
    .btn:hover{border-color: rgba(198,40,40,.35)}
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      background: var(--accent);
      border-color: rgba(198,40,40,.20);
      color:#fff;
    }
    .btn.primary:hover{border-color: rgba(198,40,40,.55)}
    .btn.ghost{
      background: #fff;
    }

    main{margin-top:16px;display:grid;grid-template-columns: 1.2fr .8fr;gap:14px;align-items:start}
    @media (max-width: 920px){
      header{position:static}
      main{grid-template-columns:1fr}
      .pill{justify-content:flex-start}
    }

    .card{
      border:1px solid var(--line);
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:13px 14px;
      border-bottom: 1px solid var(--line);
      background: #fff;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .card .hd h2{font-size:14px;margin:0;letter-spacing:.2px}
    .card .bd{padding:14px}
    .muted{color:var(--muted); font-size:12px}

    .grid{display:grid;grid-template-columns: repeat(2, minmax(0,1fr));gap:12px}
    @media (max-width: 520px){.grid{grid-template-columns:1fr}}

    .product{
      background: #fff;
      border:1px solid var(--line);
      border-radius: 14px;
      padding:12px;
      display:flex;flex-direction:column;gap:10px;
      min-height: 138px;
    }
    .product .top{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .product h3{margin:0;font-size:14px;line-height:1.25}
    .price{
      font-weight:900;
      color: var(--text);
      background: rgba(46,125,50,.08);
      border:1px solid rgba(46,125,50,.18);
      padding:6px 8px;border-radius: 12px;font-size:12px;white-space:nowrap;
    }
    .desc{margin:0;font-size:12px;color:var(--muted)}

    .qtyRow{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:auto}
    .qty{display:flex;align-items:center;gap:8px}

    .iconBtn{
      width:34px;height:34px;border-radius: 12px;
      border:1px solid var(--line);
      background: #fff;
      color:var(--text);
      cursor:pointer;
      font-size:16px;
      font-weight:900;
      display:grid;place-items:center;
      transition: border-color .15s ease, transform .08s ease, background .15s ease;
    }
    /* + yeşil, - kırmızı */
    .iconBtn.plus:hover{border-color: rgba(46,125,50,.55); background: rgba(46,125,50,.06)}
    .iconBtn.minus:hover{border-color: rgba(198,40,40,.55); background: rgba(198,40,40,.05)}
    .iconBtn:active{transform: translateY(1px)}
    .qtyNum{min-width:26px;text-align:center;font-weight:900}

    .cartLine{
      display:flex;justify-content:space-between;gap:10px;
      padding:10px 0;border-bottom: 1px dashed rgba(20,22,21,.18);
      font-size:13px;
    }
    .cartLine:last-child{border-bottom:none}
    .cartLine .l{display:flex;flex-direction:column;gap:2px}
    .cartLine .r{font-weight:900;white-space:nowrap}

    .sumRow{
      display:flex;align-items:center;justify-content:space-between;
      padding-top:10px;border-top: 1px solid var(--line);
      margin-top:10px;font-weight:900;
    }

    .form{display:grid;gap:10px;margin-top:12px}
    label{font-size:12px;color:var(--muted)}
    input, select, textarea{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid var(--line);
      background: #fff;
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus, textarea:focus{
      border-color: rgba(46,125,50,.45);
      box-shadow: 0 0 0 3px rgba(46,125,50,.10);
    }
    textarea{min-height:72px;resize:vertical}
    .row2{display:grid;grid-template-columns: 1fr 1fr;gap:10px}
    @media (max-width: 520px){.row2{grid-template-columns:1fr}}

    .toast{
      position: fixed;left: 50%;bottom: 18px;transform: translateX(-50%);
      background: #141615;
      border:1px solid rgba(255,255,255,.12);
      color:#fff;
      padding: 10px 12px;border-radius: 14px;
      box-shadow: var(--shadow);
      display:none;
      max-width: min(560px, calc(100% - 24px));
      z-index: 999;
      font-size: 13px;
    }
    .split{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .mini{font-size:11px;color:var(--muted)}
    .okBadge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(46,125,50,.20);
      background: rgba(46,125,50,.08);
      color: #1f5a24;
      font-weight:800;
      white-space:nowrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Taşkınlar Gurme</h1>
          <p>Siteye özel hızlı su siparişi</p>
        </div>
      </div>

      <div class="pill" aria-label="Bilgiler">
        <div class="tag"><strong>Üyelik yok</strong></div>
        <div class="tag"><strong>Tahmini</strong> 20–45 dk</div>
        <div class="tag">Durum: <strong id="openState">Açık</strong></div>
      </div>

      <div class="cta">
        <button class="btn ghost" id="btnReset" title="Sepeti temizle">Sepeti sıfırla</button>
        <button class="btn primary" id="btnScrollCart" title="Siparişi tamamla">Siparişe git</button>
      </div>
    </header>

    <main>
      <!-- PRODUCTS -->
      <section class="card">
        <div class="hd">
          <h2>Su</h2>
          <div class="okBadge">Hızlı sipariş</div>
        </div>
        <div class="bd">
          <div class="grid" id="productGrid"></div>
        </div>
      </section>

      <!-- CART + CHECKOUT -->
      <aside class="card" id="cartCard">
        <div class="hd">
          <h2>Sepet</h2>
          <div class="muted" id="cartMeta">0 adet</div>
        </div>
        <div class="bd">
          <div id="cartLines" class="muted">Sepet boş. Soldan ürün ekle.</div>

          <div class="sumRow">
            <span>Toplam</span>
            <span id="cartTotal">0 ₺</span>
          </div>

          <div class="form" style="margin-top:14px">
            <div class="row2">
              <div>
                <label for="apt">Daire No</label>
                <input id="apt" placeholder="Örn: B2-14 / 3-12" autocomplete="off" />
              </div>
              <div>
                <label for="phone">Telefon</label>
                <input id="phone" placeholder="05xx xxx xx xx" inputmode="tel" autocomplete="tel" />
              </div>
            </div>

            <div>
              <label for="pay">Ödeme</label>
              <select id="pay">
                <option value="Kapıda Nakit">Kapıda Nakit</option>
                <option value="Kapıda Kart">Kapıda Kart</option>
              </select>
            </div>

            <div>
              <label for="note">Not (opsiyonel)</label>
              <textarea id="note" placeholder="Örn: Kapıya bırak / zile basma / bozuk para yok"></textarea>
            </div>

            <div class="split">
              <button class="btn primary" id="btnOrder">Siparişi Tamamla</button>
              <button class="btn" id="btnCopy">Sipariş Metnini Kopyala</button>
            </div>

            <div class="mini">
              Sipariş WhatsApp’a hazır mesaj olarak gider.
            </div>
          </div>
        </div>
      </aside>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===============================
    // CONFIG — WhatsApp numaranı buraya yaz (BAŞINDA + YOK)
    // Örn: 905551112233
    // ===============================
    const STORE = {
      name: "Taşkınlar Gurme",
      whatsappPhoneE164: "90XXXXXXXXXX"
    };

    // Ürünler — su odaklı (Stage 1)
    const PRODUCTS = [
      { id:"w1", name:"Damacanа 19L (Depozitosuz)", desc:"Yeni damacana.", price: 95 },
      { id:"w2", name:"Damacanа 19L (Dolum)", desc:"Boş damacana ile değişim.", price: 70 },
      { id:"w3", name:"5L Pet Su", desc:"Pratik.", price: 35 },
      { id:"w4", name:"1.5L Pet Su (6'lı)", desc:"Koli (6 adet).", price: 60 },
      { id:"w5", name:"0.5L Pet Su (12'li)", desc:"Koli (12 adet).", price: 55 },
      { id:"w6", name:"0.33L Su (24'lü)", desc:"Koli (24 adet).", price: 95 }
    ];

    // ===============================
    // State
    // ===============================
    const LS_KEY = "taskinlar_gurme_cart_v1";
    let cart = loadCart();

    // ===============================
    // Helpers
    // ===============================
    function formatTL(n){
      return new Intl.NumberFormat("tr-TR", { maximumFractionDigits:0 }).format(n) + " ₺";
    }
    function toast(msg){
      const t = document.getElementById("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._timer);
      toast._timer = setTimeout(()=> t.style.display = "none", 2200);
    }
    function saveCart(){
      localStorage.setItem(LS_KEY, JSON.stringify(cart));
    }
    function loadCart(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        return raw ? JSON.parse(raw) : {};
      }catch(e){
        return {};
      }
    }
    function cartCount(){
      return Object.values(cart).reduce((a,b)=>a+b,0);
    }
    function cartTotal(){
      let sum = 0;
      for(const [pid, qty] of Object.entries(cart)){
        const p = PRODUCTS.find(x=>x.id===pid);
        if(p) sum += p.price * qty;
      }
      return sum;
    }
    function ensureQty(pid){ return cart[pid] || 0; }
    function setQty(pid, qty){
      if(qty <= 0) delete cart[pid];
      else cart[pid] = qty;
      saveCart();
      render();
    }
    function inc(pid){ setQty(pid, ensureQty(pid) + 1); }
    function dec(pid){ setQty(pid, ensureQty(pid) - 1); }

    // ===============================
    // Render Products
    // ===============================
    function renderProducts(){
      const grid = document.getElementById("productGrid");
      grid.innerHTML = "";

      PRODUCTS.forEach(p=>{
        const q = ensureQty(p.id);
        const el = document.createElement("div");
        el.className = "product";
        el.innerHTML = `
          <div class="top">
            <div>
              <h3>${escapeHtml(p.name)}</h3>
              <p class="desc">${escapeHtml(p.desc)}</p>
            </div>
            <div class="price">${formatTL(p.price)}</div>
          </div>

          <div class="qtyRow">
            <div class="muted">Adet</div>
            <div class="qty" aria-label="${escapeHtml(p.name)} adet seçimi">
              <button class="iconBtn minus" data-act="dec" data-id="${p.id}" aria-label="Azalt">–</button>
              <div class="qtyNum" id="qty_${p.id}">${q}</div>
              <button class="iconBtn plus" data-act="inc" data-id="${p.id}" aria-label="Artır">+</button>
            </div>
          </div>
        `;
        grid.appendChild(el);
      });

      grid.querySelectorAll("button[data-act]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-act");
          act === "inc" ? inc(id) : dec(id);
        });
      });
    }

    // ===============================
    // Render Cart
    // ===============================
    function renderCart(){
      const lines = document.getElementById("cartLines");
      const meta = document.getElementById("cartMeta");
      const totalEl = document.getElementById("cartTotal");

      const count = cartCount();
      meta.textContent = count + " adet";

      if(count === 0){
        lines.className = "muted";
        lines.innerHTML = "Sepet boş. Soldan ürün ekle.";
        totalEl.textContent = formatTL(0);
        return;
      }

      lines.className = "";
      lines.innerHTML = "";

      for(const [pid, qty] of Object.entries(cart)){
        const p = PRODUCTS.find(x=>x.id===pid);
        if(!p) continue;

        const row = document.createElement("div");
        row.className = "cartLine";
        row.innerHTML = `
          <div class="l">
            <div><strong>${escapeHtml(p.name)}</strong></div>
            <div class="muted">${qty} x ${formatTL(p.price)}</div>
          </div>
          <div class="r">${formatTL(p.price * qty)}</div>
        `;
        lines.appendChild(row);
      }

      totalEl.textContent = formatTL(cartTotal());
    }

    // ===============================
    // Checkout Message
    // ===============================
    function generateOrderNo(){
      const d = new Date();
      const y = d.getFullYear().toString().slice(-2);
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      const rnd = Math.floor(1000 + Math.random()*9000);
      return `${y}${m}${day}-${rnd}`;
    }

    function buildOrderText(){
      const apt = document.getElementById("apt").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const pay = document.getElementById("pay").value;
      const note = document.getElementById("note").value.trim();

      const count = cartCount();
      if(count === 0) return { ok:false, msg:"Sepet boş." };
      if(!apt) return { ok:false, msg:"Daire numarası gerekli." };
      if(!phone) return { ok:false, msg:"Telefon numarası gerekli." };

      const orderNo = generateOrderNo();
      const items = Object.entries(cart).map(([pid, qty])=>{
        const p = PRODUCTS.find(x=>x.id===pid);
        return p ? `- ${p.name} x${qty} (${formatTL(p.price*qty)})` : null;
      }).filter(Boolean).join("\n");

      const total = formatTL(cartTotal());

      const text =
`${STORE.name} | Su Siparişi
Sipariş No: ${orderNo}

Daire: ${apt}
Telefon: ${phone}
Ödeme: ${pay}

Ürünler:
${items}

Toplam: ${total}${note ? `\n\nNot: ${note}` : ""}`;

      return { ok:true, text, orderNo };
    }

    function openWhatsApp(text){
      const encoded = encodeURIComponent(text);
      const phone = STORE.whatsappPhoneE164.replace(/\D/g,"");
      const url = phone
        ? `https://wa.me/${phone}?text=${encoded}`
        : `https://wa.me/?text=${encoded}`;
      window.open(url, "_blank", "noopener,noreferrer");
    }

    async function copyText(text){
      try{
        await navigator.clipboard.writeText(text);
        toast("Kopyalandı");
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        toast("Kopyalandı");
      }
    }

    function render(){
      renderProducts();
      renderCart();
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ===============================
    // Events
    // ===============================
    document.getElementById("btnReset").addEventListener("click", ()=>{
      cart = {};
      saveCart();
      render();
      toast("Sepet sıfırlandı.");
    });

    document.getElementById("btnScrollCart").addEventListener("click", ()=>{
      document.getElementById("cartCard").scrollIntoView({ behavior:"smooth", block:"start" });
    });

    document.getElementById("btnOrder").addEventListener("click", ()=>{
      const res = buildOrderText();
      if(!res.ok){ toast(res.msg); return; }
      toast("WhatsApp açılıyor…");
      openWhatsApp(res.text);
    });

    document.getElementById("btnCopy").addEventListener("click", async ()=>{
      const res = buildOrderText();
      if(!res.ok){ toast(res.msg); return; }
      await copyText(res.text);
    });

    render();
  </script>
</body>
</html>
